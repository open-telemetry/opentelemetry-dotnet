name: Resolve automation settings

on:
  workflow_call:
    outputs:
      enabled:
        value: ${{ jobs.resolve-automation.outputs.enabled == 'true' }}
      username:
        value: ${{ vars.AUTOMATION_USERNAME }}
      email:
        value: ${{ vars.AUTOMATION_EMAIL }}
      application-name:
        value: ${{ vars.AUTOMATION_APPLICATION_NAME }}
      application-username:
        value: ${{ vars.AUTOMATION_APPLICATION_USERNAME }}
    secrets:
      OTELBOT_DOTNET_PRIVATE_KEY:
        required: false

permissions:
  contents: read

jobs:
  resolve-automation:

    runs-on: ubuntu-22.04

    outputs:
      enabled: ${{ steps.evaluate.outputs.enabled }}

    env:
      OTELBOT_DOTNET_PRIVATE_KEY_EXISTS: ${{ secrets.OTELBOT_DOTNET_PRIVATE_KEY != '' }}

    steps:
    - id: evaluate
      run: |
        echo "enabled=${{ env.OTELBOT_DOTNET_PRIVATE_KEY_EXISTS == 'true' }}" >> "$GITHUB_OUTPUT"
